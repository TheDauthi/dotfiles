#!/usr/bin/env bash

SCRIPT_PATH="$(dirname $0)"

source "${SCRIPT_PATH}/.installer/lib/path.lib.sh"
source "${SCRIPT_PATH}/.installer/lib/install.lib.sh"

SHELLRC_PATH=${SHELLRC_PATH:-~/.shellrc}

mkdir -p "${HOME}/.shellrc/local.d" "${HOME}/bin" "${HOME}/.byobu" "${HOME}/.shellrc/plugins"

# Clean up broken symlinks
find "${HOME}" -maxdepth 1 -xtype l -delete

cd "${SHELLRC_PATH}"

install_or_warn "dotfiles/bin" "bin"

declare -a paths=("init" "init.d" "login.d" "platform.d" "shell.conf.d" "shellrc.d" )

for path in "${paths[@]}"; do
  install_or_warn "dotfiles/init/${path}" "${path}"
done

cd "${HOME}"

declare -A DOTMAP=(
  [.bashrc]=files/bash/bashrc
  [.bash_profile]=files/bash/bash_profile
  [.zshrc]=files/zsh/zshrc
  [.vimrc]=files/vim/vimrc
  [.byobu/status]=files/byobu/status
  [.byobu/keybindings.tmux]=files/byobu/keybindings.tmux
  [.shellrc/plugins/fasd]=files/plugins/fasd
) 

for file in "${!DOTMAP[@]}"; do
  DOTFILE="${SHELLRC_PATH}/dotfiles/${DOTMAP[$file]}"
  DOTFILE=$(real_to_abspath "${HOME}" "${DOTFILE}")
  
  install_or_warn "${DOTFILE}" "${file}"
done
